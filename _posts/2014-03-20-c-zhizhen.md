---
layout: post
title: "C语言指针"
description: "C语言指针"
category: C
tags: [C]
---
{% include JB/setup %}

<ul>
    <li>作者：<a href="http://weibo.com/xpmozong" target="blank">寞踪</a></li>
    <li>本文地址：http://xpmozong.github.io/c/2014/03/20/c-zhizhen/</li>
    <li>转载请注明出处</li>
</ul>

C语言指针

<b>指针变量定义</b>
    
    int *p = NULL;

p 为变量名，NULL初始值，NULL恒等于0。

与普通变量不同的是，定义指针变量的时候，前面需要加 * 。

    int a = 3;
    int *p = &a;

指针取地址

<b>指针重新赋值</b>
    
    *p = 100;

*p 代表 a，p代表a的地址

<b>指针数组</b>
    
    int arr[3] = {1,3,8};

在C语言中，数组是构造类型，系统会分配一段连续的空间来存储数组的全部数据。其中数组名代表数组首元素地址（第一个元素的内存地址）。

arr 恒等于 &arr[0]。

    int *p = arr; 保存数组首地址

此时p与arr相同，均指向数组的首地址。

p[1] = 3;

恒等于a[1]
恒等于*(p+1)
恒等于*(a+1)

<b>指针与字符串</b>
 
    char string[] = "iPhone";
    char *p = string;

<b>指针数组</b>
    
    char *strings[3] = {"iPhone", "Android", "win8"};

注意可以通过指针来修改字符数组，但不可以修改字符串。修改用strcopy。

<b>结构体指针</b>
    
定义一个结构体
    
    typedef struct {
        char name[20];
        char sex;
    } Student;


结构体指针定义


    Student stu = {0};
    Student *p = &stu;

    //  访问
    (*p).sex = 'm';
    p->sex = 'm';
    
    printf("%c\n", p->sex); 

<b>结构体数组</b>
    
    Student stus[3] = {0};
    Student *p = stus;

    for(int i = 0, i < 3, i++){
        printf("%c ", (p+i)->sex);
    }


<b>结构体指针为函数参数</b>

    void printStudents(const Student * pstu, int count);


<b>函数指针定义</b>
    
    int maxValue(int a, int b)
    {
        return a > b ? a : b
    }

    int (*p)(int a, int b) = NULL;
    p = maxValue;   // 赋值函数名
    int m = p(3,5); // 指针可当函数用


<b>回调函数</b>

    int getValue(int a, int b, int (*p)(int,int))
    {
        return p(a, b);
    }


函数指针做getValue函数的参数

    int value = getValue(3,5, maxValue);


<b>int数组动态排序</b>

    typedef bool(*PFUN)(int,int); // 为函数指针类型类型起名为PFUN

    void sortArray(int *arr, int count, PFUN p);


<b>定义结构体，存名称和指针函数</b>

    typedef struct nameFunctionPair
    {
        char funcName[30];
        PFUN pFun;
    } NameFunctionPair;

<b>返回值为函数指针</b>

    PFUNC getFunctionByName(const char *fname)
    {
        NameFunctionPair funcs[] = {
            {"max", maxValue},
            {"min", minValue},
            {"avg", avgValue}
        };
        
        PFUN pFun = NULL;
        for (int i = 0; i < sizeof(funcs) / sizeof(*funcs); i++) {
            if (strcmp(fname, funcs[i].funcName) == 0) {
                pFun = funcs[i].pFun;
                break;
            }
        }

        return pFun;
    }
   
通过功能名称查找对应的函数

    PFUN fun = NULL;
    fun = getFunctionByName("min");
    int value = fun(3,5);   // 使用返回的函数指针调用函数，完成动态调用

